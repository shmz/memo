---
layout: post
title:  graalvm
date:   2019-05-21 16:15:43 +0900
categories: [JVM]
---

- https://qiita.com/koduki/items/e53cb109c47b903de528
- https://hub.docker.com/r/oracle/graalvm-ce
- https://www.graalvm.org/docs/getting-started/#docker-containers

```
docker pull oracle/graalvm-ce:1.0.0-rc16
```

```java
public class Hello {
  public static void main(String[] args) {
    System.out.println("Hello, World!");
  }
}
```

```
docker run -it -v "`pwd`:/src" oracle/graalvm-ce:1.0.0-rc16 javac /src/Hello.java
```

```
docker run -it -v "`pwd`:/src" oracle/graalvm-ce:1.0.0-rc16 java -version
openjdk version "1.8.0_202"
OpenJDK Runtime Environment (build 1.8.0_202-20190206132807.buildslave.jdk8u-src-tar--b08)
OpenJDK GraalVM CE 1.0.0-rc16 (build 25.202-b08-jvmci-0.59, mixed mode)
```

```
$ docker run -it -v "`pwd`:/src" oracle/graalvm-ce:1.0.0-rc16 /bin/bash
bash-4.2# cd src
bash-4.2# native-image Hello
Build on Server(pid: 10, port: 45523)*
[hello:10]    classlist:   4,285.34 ms
[hello:10]        (cap):   2,186.25 ms
[hello:10]        setup:   5,889.79 ms
[hello:10]   (typeflow):   8,862.45 ms
[hello:10]    (objects):   2,198.00 ms
[hello:10]   (features):     399.73 ms
[hello:10]     analysis:  11,659.88 ms
[hello:10]     universe:     533.22 ms
[hello:10]      (parse):   2,412.32 ms
[hello:10]     (inline):   3,821.79 ms
[hello:10]    (compile):  18,157.09 ms
[hello:10]      compile:  24,989.69 ms
[hello:10]        image:     722.68 ms
[hello:10]        write:     297.69 ms
[hello:10]      [total]:  48,837.29 ms

bash-4.2# file ./hello
./hello: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.32, BuildID[sha1]=30ca7b96f8f4615a48f11502b868bc61c99614ea, not stripped
```

Ghidraで確認

```c
void main(int param_1,long param_2,undefined8 param_3,undefined8 param_4,ulong **param_5,
         ulong param_6)
{
  uint uVar1;
  undefined8 uVar2;
  undefined8 extraout_RDX;
  undefined8 extraout_RDX_00;
  undefined8 extraout_RDX_01;
  undefined8 unaff_R15;
  bool bVar3;
  
  uVar2 = CEntryPointSnippets_createIsolate_f1111fe1c782eae0d0e674e1aba1dff3bc5e04ea
                    (0,0xe8,param_3,unaff_R15,(undefined *)param_5);
  uVar1 = (uint)uVar2;
  uVar2 = extraout_RDX;
  if (uVar1 == 0) {
    unaff_R15 = 1;
    LOCK();
    bVar3 = _DAT_000000e4 == 3;
    _DAT_000000e4 = _DAT_000000e4 ^ (uint)bVar3 * (_DAT_000000e4 ^ 1);
    if (!bVar3) {
      Safepoint_enterSlowPathNativeToJava_7405606951b146d1e5a18c3861fef52afd34fa42();
    }
    uVar2 = CEntryPointSnippets_initializeIsolate_d0c89925cb55aeb9f29e01c065f8625ff6aa5311();
    uVar1 = (uint)uVar2;
    uVar2 = extraout_RDX_01;
  }
  if (uVar1 != 0) {
    CEntryPointSnippets_failFatally_f9518a09837cd81f754a9910fba1cfdc09ffb3e9
              (uVar1,s_Failed_to_create_a_new_Isolate._00831118);
    uVar2 = extraout_RDX_00;
  }
  JavaMainWrapper_run_5087f5482cc9a6abc971913ece43acb471d2631b
            (param_1,param_2,uVar2,unaff_R15,param_5,param_6);
  _DAT_000000e4 = 3;
  return;
}
```
