---
layout: post
title:  マルウェア永続化手法
date:   2019-05-21 16:15:43 +0900
categories: [JVM]
---

マルウェアの永続化手法についてのまとめ

参考
- [Learning Malware Analysis: Explore the concepts, tools, and techniques to analyze and investigate Windows malware](https://www.amazon.co.jp/Learning-Malware-Analysis-techniques-investigate/dp/1788392507)
    - Malware Persistence Methodsを参考にまとめた

### 手法の一覧(Windows)

- 実行レジストリキーの追加
- タスクスケジューラ（Scheduled Tasks）
- スタートアップ（Startup Folder）
- Winlogonレジストリエントリ（Winlogon Registry Entries）
- イメージファイル実行オプション（Image File Execution Options）
- アクセシビリティプログラム（Accessibility Programs）
- AppInit_DLLs
- DLLハイジャック（DLL Search Order Hijacking）
- COMハイジャック（COM hijacking）
- サービス

### 実行レジストリキーの追加

- 場所

```
HKCU\Software\Microsoft\Windows\CurrentVersion\Run
HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce
HKCU\Software\Microsoft\Windows\CurrentVersion\RunOnce
HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run
HKCU\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run
```

- 検知
    - Sysinternals（https://docs.microsoft.com/ja-jp/sysinternals/downloads/autoruns）のAutoRunsユーティリティを使用


### タスクスケジューラ（Scheduled Tasks）


### スタートアップ（Startup Folder）


### Winlogonレジストリエントリ（Winlogon Registry Entries）


### イメージファイル実行オプション（Image File Execution Options）


### アクセシビリティプログラム（Accessibility Programs）

	スクリーンキーボード
	ナレーター

### AppInit_DLLs

	アプリにカスタムDLLをロード、APIをフックするなど
	HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Windows

### DLLハイジャック（DLL Search Order Hijacking）

	system32
	アプリ起動ディレクトリ
	システムディレクトリ
	16ビットシステムディレクトリ
	Windowsディレクトリ
	カレントディレクトリ
	PATH変数で定義されたディレクトリ

### COMハイジャック（COM hijacking）

	HKCU\Software\Classes\CLSID\以下のエントリを書き換える

### サービス

	HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services
	新たにサービス作成
	既存サービスの置換

